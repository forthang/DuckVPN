<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Информация о подписке</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>

    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.0/dist/cdn.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/i18n@2.4.0/dist/cdn.min.js"></script>
    
    <script defer src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827;
            color: #e5e7eb;
        }
        [x-cloak] { display: none !important; }
        .active-os {
            outline: 2px solid #38bdf8;
            box-shadow: 0 4px 14px 0 rgba(56, 189, 248, 0.3);
        }
    </style>
</head>
<body class="antialiased">
    <div x-data="subscriptionManager" x-init="init()" x-cloak class="max-w-sm mx-auto p-4" style="width: 393px;">

        <header class="text-center mb-6">
            <h1 class="text-2xl font-bold">Настройте ваш VPN</h1>
            <p class="text-gray-400 text-sm mt-1">Выберите устройство и следуйте инструкции.</p>
        </header>

        <main class="space-y-4">
            <div class="grid grid-cols-3 gap-3 mb-6">
                <template x-for="os in osOptions" :key="os.id">
                    <div @click="selectedOs = os.id" 
                         :class="{ 'active-os': selectedOs === os.id }" 
                         class="cursor-pointer flex items-center justify-center bg-gray-800 rounded-lg transition-transform transform hover:scale-105 h-16"
                         tabindex="0" :aria-label="os.name" @keydown.enter.space="selectedOs = os.id">
                        <img :src="os.icon" :alt="os.name + ' logo'" class="h-10 w-10 object-contain"/>
                    </div>
                </template>
                <div @click="openQrModal()"
                     class="cursor-pointer flex items-center justify-center bg-gray-800 rounded-lg transition-transform transform hover:scale-105 h-16"
                     role="button" aria-label="Показать QR-код">
                     <svg xmlns="http://www.w3.org/2000/svg" class="h-9 w-9 text-gray-400" viewBox="0 0 24 24" fill="currentColor"><path d="M3 11h8V3H3v8zm2-6h4v4H5V5zM3 21h8v-8H3v8zm2-6h4v4H5v-4zM13 3v8h8V3h-8zm6 6h-4V5h4v4zM13 13h2v2h-2zM15 15h2v2h-2zM13 17h2v2h-2zM17 17h2v2h-2zM19 19h2v2h-2zM15 19h2v2h-2zM17 13h2v2h-2zM19 15h2v2h-2z"></path></svg>
                </div>
            </div>

            <div class="bg-gray-800 p-4 rounded-lg">
                <p class="text-base font-semibold mb-3"><span class="text-blue-400">1</span> Скачать VPN</p>
                <a :href="currentOs.downloadUrl" target="_blank" class="w-full flex items-center justify-center bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition-colors text-lg" style="height: 52px;">
                   Скачать
                </a>
                <template x-if="selectedOs === 'Linux'">
                    <div class="mt-4 pt-4 border-t border-gray-700">
                        <div class="flex justify-between items-center mb-2">
                            <p class="text-sm font-semibold text-gray-300">Или установка через терминал:</p>
                            <button @click="copyTerminalCommands($el)" class="text-xs bg-gray-700 hover:bg-gray-600 px-2 py-1 rounded">Копировать</button>
                        </div>
                        <pre class="bg-gray-900 text-gray-300 text-xs p-3 rounded-md whitespace-pre-wrap break-all"><code id="linux-commands">wget -O Happ.AppImage https://github.com/Happ-proxy/happ-desktop/releases/latest/download/Happ.linux.x86.AppImage
chmod +x Happ.AppImage
./Happ.AppImage</code></pre>
                    </div>
                </template>
            </div>

            <div x-data="{ open: true }" class="bg-gray-800 rounded-lg">
                <button @click="open = !open" class="w-full flex justify-between items-center text-left p-4">
                    <p class="text-lg font-bold"><span class="text-orange-400">2</span> Добавить конфиг</p>
                    <svg :class="{'rotate-180': open}" class="w-5 h-5 transition-transform flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </button>
                <div x-show="open" x-transition class="p-4 pt-0">
                    <a :href="user.subscription_url" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-lg mb-3 text-center block" style="height: 48px;">
                        Добавить в приложение
                    </a>
                    <div class="flex mb-4">
                        <input type="text" :value="user.subscription_url" class="w-full bg-gray-700 text-gray-300 rounded-l-lg p-2 text-sm focus:outline-none" readonly/>
                        <button @click="copyToClipboard(user.subscription_url, $el)" class="bg-gray-600 hover:bg-gray-500 text-white font-bold px-4 rounded-r-lg">
                            Копировать
                        </button>
                    </div>
                    <p class="text-sm text-gray-400">Если что-то не работает — копируйте и следуйте скриншотам ниже.</p>
                    
                    <div class="mt-4">
                        <template x-if="selectedOs === 'Android'">
                            <img @click="openImageModal($el.src)" src="https://i.ibb.co/Ldmsx05G/0-1.jpg" alt="Инструкция для Android" class="rounded-lg w-full h-auto cursor-pointer">
                        </template>
                        <template x-if="selectedOs === 'iOS'">
                            <img @click="openImageModal($el.src)" src="https://i.ibb.co/Rk1NPRwL/0-2-2.jpg"  alt="Инструкция для iOS" class="rounded-lg w-full h-auto cursor-pointer">
                        </template>
                        <template x-if="!['Android', 'iOS'].includes(selectedOs)">
                            <div class="grid grid-cols-2 gap-3 text-center">
                                <div class="text-xs text-gray-400">
                                    <img @click="openImageModal($el.src)" src="https://i.ibb.co/RkNL395H/0-2.jpg" alt="Инструкция, шаг 1" class="rounded-lg w-full h-auto mb-2 cursor-pointer">
                                    ТАК
                                </div>
                                <div class="text-xs text-gray-400">
                                    <img @click="openImageModal($el.src)" src="https://i.ibb.co/7cTGt1w/0-1.jpg" alt="Инструкция, шаг 2" class="rounded-lg w-full h-auto mb-2 cursor-pointer">
                                    или ТАК
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
            
            <div @click="openQrModal()" class="bg-gray-800 p-3 rounded-lg cursor-pointer">
                <div class="flex items-center">
                    <div class="mr-3 bg-white p-1 rounded-md inline-block">
                         <img src="https://api.qrserver.com/v1/create-qr-code/?size=72x72&data=https://duckivpn.npvpn.net/static/sub.html" alt="QR-код для настройки VPN" width="72" height="72">
                    </div>
                    <div class="flex-1">
                        <h3 class="font-semibold whitespace-nowrap">QR-код для другого устройства</h3>
                        <p class="text-sm text-gray-400 whitespace-nowrap">Отсканируйте для быстрой настройки</p>
                    </div>
                </div>
            </div>

            <div x-data="{ open: true }" class="bg-gray-800 p-4 rounded-lg">
                <button @click="open = !open" class="w-full flex justify-between items-center text-left">
                    <h3 class="font-semibold">Информация о подписке</h3>
                    <svg :class="{'rotate-180': open}" class="w-5 h-5 transition-transform flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </button>
                <div x-show="open" x-transition class="mt-4 pt-4 border-t border-gray-700">
                     <div class="flex items-center space-x-3">
                        <div :class="statusInfo.color" class="w-3 h-3 rounded-full flex-shrink-0"></div>
                        <div class="text-sm space-y-1">
                            <p class="text-gray-400">ID: <span class="text-white font-semibold" x-text="user.username"></span></p>
                            <p class="text-gray-400">Статус: <span class="font-semibold" :class="statusInfo.textColor" x-text="$t(user.status.value, 'Статус не найден')"></span></p>
                            <p class="text-gray-400">Использовано: 
                                <span class="text-white" x-text="formatBytes(user.used_traffic)"></span> / 
                                <span class="text-white" x-text="user.data_limit === 0 ? '∞' : formatBytes(user.data_limit)"></span>
                            </p>
                            <p class="text-gray-400">Конец подписки: <span class="text-white" x-text="formatDate(user.expire)"></span></p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-gray-800 p-4 rounded-lg">
                <h3 class="font-semibold mb-1">Нужна помощь?</h3>
                <p class="text-sm text-gray-400 mb-2">Если возникли трудности, обратитесь в службу поддержки.</p>
                <a href="https://t.me/manoili" target="_blank" class="text-blue-400 hover:underline">Связаться с поддержкой</a>
            </div>
        </main>

        <div x-show="isQrModalOpen" @keydown.escape.window="isQrModalOpen = false" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-75 transition-opacity" @click.self="isQrModalOpen = false">
            <div x-show="isQrModalOpen" x-transition class="bg-white p-6 rounded-lg text-center relative">
                <h3 class="text-lg font-bold text-gray-900 mb-4">Отсканируйте для подключения другого устройства</h3>
                <div id="qrcode-large" class="flex justify-center"></div>
                <button @click="isQrModalOpen = false" class="absolute top-2 right-2 text-gray-500 hover:text-gray-800">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
        </div>

        <div x-show="isImageModalOpen" @keydown.escape.window="isImageModalOpen = false" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-75 transition-opacity" @click.self="isImageModalOpen = false">
            <div x-show="isImageModalOpen" x-transition class="p-4 relative">
                <img :src="modalImageUrl" class="max-w-[90vw] max-h-[90vh] rounded-lg">
                <button @click="isImageModalOpen = false" class="absolute top-0 -right-8 text-white hover:text-gray-300">
                     <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('alpine:init', () => {
            const langJson = {
                ru: { active: "Активен", limited: "Ограничен", expired: "Просрочен", disabled: "Отключен" },
                en: { active: "Active", limited: "Limited", expired: "Expired", disabled: "Disabled" }
            };

            Alpine.store('i18n', {
                locale: 'ru',
                fallbackLocale: 'ru',
                messages: langJson
            });

            Alpine.data('subscriptionManager', () => ({
                user: {
                    username: "6199148583_532",
                    subscription_url: "vless://super-long-and-secure-subscription-key-string-example/my-vpn",
                    status: { value: "expired" },
                    used_traffic: 5221440,
                    data_limit: 0,
                    expire: 1752095595
                },
                selectedOs: 'Windows',
                isQrModalOpen: false,
                isImageModalOpen: false,
                modalImageUrl: '',
                osOptions: [
                    { id: 'Windows', name: 'Windows', icon: 'https://img.icons8.com/color/96/windows-11.png', downloadUrl: 'https://github.com/Happ-proxy/happ-desktop/releases/latest/download/setup-Happ.x86.exe' },
                    { id: 'iOS', name: 'iOS', icon: 'https://img.icons8.com/?size=100&id=30659&format=png&color=ffffff', downloadUrl: 'https://apps.apple.com/us/app/foxray/id6448898396' },
                    { id: 'Android', name: 'Android', icon: 'https://img.icons8.com/color/96/android-os.png', downloadUrl: 'https://play.google.com/store/apps/details?id=com.v2ray.ang' },
                    { id: 'Linux', name: 'Linux', icon: 'https://img.icons8.com/color/96/linux--v1.png', downloadUrl: 'https://github.com/Happ-proxy/happ-desktop/releases/latest/download/Happ.linux.x86.AppImage' },
                    { id: 'AndroidTV', name: 'Android TV', icon: 'https://img.icons8.com/?size=100&id=jNETCg8rZ5qm&format=png&color=ffffff', downloadUrl: ' https://play.google.com/store/apps/details?id=com.happproxy' },
                ],
                init() {
                    document.title = `${this.user.username} - Sub Info`;
                },
                get currentOs() {
                    return this.osOptions.find(os => os.id === this.selectedOs) || this.osOptions[0];
                },
                get statusInfo() {
                    switch (this.user.status.value) {
                        case 'active': return { color: 'bg-green-500', textColor: 'text-green-500' };
                        case 'limited': return { color: 'bg-yellow-500', textColor: 'text-yellow-500' };
                        case 'expired': return { color: 'bg-red-500', textColor: 'text-red-500' };
                        default: return { color: 'bg-gray-500', textColor: 'text-gray-500' };
                    }
                },
                openQrModal() {
                    this.isQrModalOpen = true;
                    this.$nextTick(() => {
                        const qrContainer = document.getElementById('qrcode-large');
                        qrContainer.innerHTML = '';
                        new QRCode(qrContainer, { text: 'https://duckivpn.npvpn.net/static/sub.html', width: 256, height: 256, colorDark : "#000", colorLight : "#fff", correctLevel : QRCode.CorrectLevel.H });
                    });
                },
                openImageModal(src) {
                    this.modalImageUrl = src;
                    this.isImageModalOpen = true;
                },
                copyToClipboard(text, button) {
                    navigator.clipboard.writeText(text).then(() => {
                        const originalText = button.textContent;
                        button.textContent = 'Готово!';
                        setTimeout(() => { button.textContent = originalText; }, 2000);
                    });
                },
                copyTerminalCommands(button) {
                    const text = document.getElementById('linux-commands').innerText;
                    this.copyToClipboard(text, button);
                },
                formatBytes(bytes, decimals = 2) {
                    if (!+bytes) return '0 Bytes';
                    const k = 1024;
                    const dm = decimals < 0 ? 0 : decimals;
                    const sizes = ["Bytes", "KB", "MB", "GB", "TB"];
                    const i = Math.floor(Math.log(bytes) / Math.log(k));
                    return `${parseFloat((bytes / Math.pow(k, i)).toFixed(dm))} ${sizes[i]}`;
                },
                formatDate(timestamp) {
                    if (!timestamp) return 'N/A';
                    return new Date(timestamp * 1000).toLocaleString('ru-RU', { dateStyle: 'short', timeStyle: 'medium' });
                }
            }));
        });
    </script>
</body>
</html>